import { Request } from "json-rpc.js"

export async function send(method, params) {
    const fetch = process.browser ? window.fetch : require('node-fetch').default;

    const request = new Request(method, params)

    return await fetch(process.env.OCEAN_API_URL, {
        method: "POST",
        body: request.toString()
    }).then(r => r.text())
        .then(json => {
            try {
                const response = JSON.parse(json);

                if (response.error) {
                    throw ("API server error: " + JSON.stringify(response.error));
                } else {
                    return response.result || null;
                }
            } catch (err) {
                throw ("JSON parse error: " + err + ". JSON: " + json)
            }
        });
}
