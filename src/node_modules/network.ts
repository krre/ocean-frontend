import { Request } from "json-rpc"
import { message } from "api-error"
import node_fetch from 'node-fetch'

export async function send(method, params) {
    const isBrowser = typeof window !== 'undefined';
    const fetch = isBrowser ? window.fetch : node_fetch;

    const request = new Request(method, params)

    return await fetch(process.env.OCEAN_API_URL, {
        method: "POST",
        body: request.toString()
    }).then(r => r.text())
        .then(json => {
            const response = JSON.parse(json);

            if (response.error) {
                throw (response.error);
            } else {
                return response.result || null;
            }
        });
}

export function errorMessage(code) {
    return message(code);
}
